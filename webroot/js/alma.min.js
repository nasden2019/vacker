if("undefined"==typeof jQuery)throw new Error("ALMA necesita jQuery");$.ALMA={},$.ALMA.opciones={debug:!0,local:"/alma/"},"undefined"!=typeof SyloperOpciones&&$.extend(!0,$.ALMA.opciones,ALMAOpciones);var o=$.ALMA.opciones;function _iniciar(){"use strict";$.ALMA.select2={iniciar:function(){$(".select2").length&&$("#modalHistoria").on("shown.bs.modal",function(e){$(".select2").each(function(i,e){var ph=$(this).data("placeholder");$(e).select2({dropdownParent:"#modalHistoria",placeholder:ph,allowClear:!0,theme:"bootstrap4",language:"es"})})})}},$.ALMA.cajas={ultimoID:!1,iniciar:function(){var _this=this;setTimeout(()=>{$("#contenedor-sitio").addClass("loaded")},800),$(".avanzar").on("click",function(e){e.preventDefault();var cat=$(this).data("categoria")||1;$("#select-categoria").val(cat),$(".caja.activa").removeClass("activa"),$(this).closest(".caja").addClass("completa").next().removeClass("oculta").addClass("activa");var resultado=$.ALMA.buscador._buscar("POST","api/getHistorias",{categoria:cat||!1,relacion:$("#select-relacion").val()||!1,etapa:$("#select-etapa").val()||!1});resultado.estado&&resultado.datos.length&&_this._crearCajas({datos:resultado.datos})}),$(".retroceder").on("click",function(e){e.preventDefault(),$(".caja.activa").removeClass("activa").addClass("oculta"),$(this).closest(".caja").removeClass("completa").addClass("activa"),$("#render-tarjetas").html(""),_this._quitar($(this).closest(".caja"))}),$("#btn-buscar-historia").on("click",function(e){e.preventDefault(),$("#render-tarjetas").html("");let resultado=$.ALMA.buscador._buscar("POST","api/getHistorias",{categoria:$("#select-categoria").val()||!1,relacion:$("#select-relacion").val()||!1,etapa:$("#select-etapa").val()||!1});resultado.estado&&resultado.datos.length&&_this._crearCajas({datos:resultado.datos})})},_quitar:function(elemento){var _this=this;elemento.next(".caja").length&&(elemento.next(".caja").removeClass("activa completa").addClass("oculta"),this._quitar(elemento.next(".caja")))},_crearCajas:function(datos,alFinal){var source=$("#template-tarjeta").html(),template,result=Handlebars.compile(source)(datos);alFinal?$("#render-tarjetas").append(result):$("#render-tarjetas").html(result),$("main").addClass("encontrados")}},$.ALMA.buscador={buscando:!1,iniciar:function(){var _this=this},_buscar:function(metodo,url,data){var _this=this,devolver=!1;return _this.buscando=!0,$.ajax({type:metodo||"GET",url:o.local+url,data:data||"",async:!1,dataType:"json",success:function(data){devolver=data},error:function(data){_d("AJAX error")},complete:function(data){_this.buscando=!1}}),devolver}},$.ALMA.publicar={iniciar:function(){var _this=this;$("#form-nueva-historia").on("submit",function(e){e.preventDefault();let form=$(this),serializado=form.serialize(),resultado=$.ALMA.buscador._buscar("POST","api/setHistoria",serializado);resultado.estado?(iziToast.success({timeout:2e4,position:"bottomRight",title:"Genial :",message:resultado.mensaje}),$("#modalHistoria").modal("hide"),form.trigger("reset")):iziToast.error({timeout:2e4,position:"bottomRight",title:"Ups :",message:resultado.mensaje})})}}}function _d(d,v){$.ALMA.opciones.debug&&(m=d,(v||0==v||0==v)&&(m=m+" : "+v),console.log(m))}_iniciar(),$(window).on("load",function(){$.ALMA.select2.iniciar(),$.ALMA.cajas.iniciar(),$.ALMA.buscador.iniciar(),$.ALMA.publicar.iniciar()}),$(window).on("scroll",function(){}),$(window).on("resize",function(){});